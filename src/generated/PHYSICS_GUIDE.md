# VR Creator 2: Physics & Interaction Guide

## üéØ Summary
This document consolidates the findings from our deep dive into the IWSDK Physics engine (Havok) and Interaction system. Use this as a reference to build stable, reliable physical interactions.

---

## 1. üèóÔ∏è The "Golden Floor" Standard
To prevent objects from falling through the floor or sinking into "swamp" terrain:

### The Rules:
1.  **Origin is Y=0**: The top surface of your floor must be exactly at `Y=0`.
2.  **Thickness Matters**: Do not use a flat plane (`0` height). Use a thick box (at least `0.1m` to `0.5m`) to prevent "tunneling" (objects passing through due to high speed).
3.  **Offset Geometry**: Since a Cube's position is its center, you must offset it by half its height.
4.  **USE AUTO SHAPE**: This is critical. Manual `Box` shape often defaults to `0x0x0` if dimensions aren't passed perfectly. `Auto` reads the Mesh geometry reliably.

### ‚úÖ Best Practice Code:
```typescript
const FLOOR_THICKNESS = 0.5;
const floorGeo = new THREE.BoxGeometry(20, FLOOR_THICKNESS, 20);
// Center Y = -0.25 (Half of 0.5). Top Face = 0.0.
const floorMesh = new THREE.Mesh(floorGeo, material);
floorMesh.position.set(0, -FLOOR_THICKNESS / 2, 0);

const floorEnt = world.createTransformEntity(floorMesh);
floorEnt.addComponent(PhysicsBody, { state: PhysicsState.Static });
floorEnt.addComponent(PhysicsShape, { 
    shape: PhysicsShapeType.Auto, // <--- CRITICAL
    restitution: 0.5, // 0.0 = Swamp/Clay. 0.5 = Concrete. 1.0 = Trampoline.
    friction: 0.5     // Standard friction
});
```

---

## 2. üß± Physics Objects (Cubes, Balls)
To ensure objects behave predictably and don't slide forever or get stuck:

### Tuning Tips:
*   **Restitution (Bounciness)**:
    *   `0.1`‚Äì`0.3` for standard objects (Wood, Plastic).
    *   `0.8`‚Äì`1.0` for Bouncy Balls.
*   **Friction**:
    *   `0.1`: Ice.
    *   `0.5`: Generic.
    *   `1.0`: Rubber / Sticky.
*   **Density**: Use `1.0` as a baseline. For heavy objects (Anvils), use `10.0`.

### ‚úÖ Best Practice Code:
```typescript
const entity = world.createTransformEntity(mesh);
entity.addComponent(PhysicsBody, { state: PhysicsState.Dynamic });
entity.addComponent(PhysicsShape, { 
    shape: PhysicsShapeType.Auto, // Reads geometry size automatically
    density: 1.0, 
    restitution: 0.3,
    friction: 0.6 
});
```

---

## 3. ‚úã Interaction (Grabbing)
We explored two modes: **Ray Rays** (`DistanceGrabbable`) and **Direct Touch** (`OneHandGrabbable`).

### A. Distance Grabbable (Rays) - ‚≠ê RECOMMENDED
The most reliable method for both Controllers and Hand Tracking (Pinch).
*   **Pros**: Easy to reach objects, standard WebXR interaction.
*   **Cons**: Can feel "magical" rather than physical.

### B. OneHandGrabbable (Direct Touch)
Requires physical overlap with the object.
*   **Trigger**:
    *   **Controllers**: Grip Button (Squeeze).
    *   **Hands**: "Fist" gesture (sometimes unreliable) or specific system mapping.
*   **Use Case**: Buttons, Levers, or immersive "God Mode" building if Grip is mapped correctly.

### ‚ö° Optimization Tip: Raycasting Performance
If you have complex objects (like a Cube with an outline/wireframe), the raycaster might hit the **lines** instead of the box, causing jitter.

**FIX**: Disable raycasting on cosmetic children.
```typescript
const edges = new THREE.LineSegments(...);
edges.raycast = () => {}; // <--- Ray passes through this object
mesh.add(edges);
```

---

## 4. üìÇ Template Artifacts
We created clean templates to start fast:
*   `src/scenes/physics-template.ts`: Minimal "Clean Slate" (Floor + 2 Objects).
*   `src/scenes/physics-jenga-final.ts`: Complex Physics Demo (Tower).

---

## üìö Source Code References
For deeper debugging, refer to these SDK files:

*   **Physics Components (Bodies, Shapes, Tuning):**
    *   `node_modules/@iwsdk/core/dist/physics/physicsShape.d.ts` (Properties like density, friction, PhysicsShapeType)
    *   `node_modules/@iwsdk/core/dist/physics/physicsBody.d.ts` (State: Static/Dynamic)
*   **Physics System Logic (Havok Integration):**
    *   `node_modules/@iwsdk/core/dist/physics/physics-system.js` (Shape creation logic, Auto detection)

*Generated by Antigravity Agent - 2025*
