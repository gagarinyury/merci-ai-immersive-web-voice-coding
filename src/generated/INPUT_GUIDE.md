# VR Creator 2: Input & Control Guide

## ðŸŽ¯ Summary
This guide documents how to handle user input (Controllers & Hand Tracking) using the IWSDK `InputSystem`. It focuses on the polling method within the animation loop, which proved most reliable during our "Shooter" and "Physics" research.

---

## 1. ðŸŽ® Accessing Input
Input is managed by `world.input`. The most common way to check input is by polling the "gamepads" (which represents both physical controllers and tracked hands in WebXR).

```typescript
const world = window.__IWSDK_WORLD__ as World;

// In your loop:
const leftPad = world.input.gamepads.left;
const rightPad = world.input.gamepads.right;
```

---

## 2. ðŸ”˜ Checking Buttons
The SDK normalizes buttons to standard WebXR IDs. Use `getButtonDown(id)` for one-frame clicks (shooting, spawning) or `getButton(id)` for holding (dragging).

| Action | ID | Controller | Hand Gesture |
| :--- | :--- | :--- | :--- |
| **Select / Fire** | `'xr-standard-trigger'` | Index Trigger | **Pinch** (Index + Thumb) |
| **Grab / Grip** | `'xr-standard-squeeze'` | Grip / Side Button | **Fist** (Squeeze Hand) |

### âœ… Best Practice Code (Shooting):
```typescript
const animate = () => {
    const gp = world.input.gamepads.right;
    
    // Fire on press start
    if (gp && gp.getButtonDown('xr-standard-trigger')) {
        fireGun();
    }
    
    requestAnimationFrame(animate);
};
```

---

## 3. ðŸ”« Attaching Objects to Hands
To attach a gun, sword, or tool to the hand, use `gripSpaces`. These are Three.js Groups that automatically follow the controller/hand transform.

```typescript
// Create your tool
const gunMesh = new THREE.Mesh(...);

// Attach to Right Hand
const rightHand = world.player.gripSpaces.right;
rightHand.add(gunMesh);

// Optional: Rotate to align with pointing direction
// (Usually -Z is forward)
gunMesh.rotation.x = -Math.PI / 2; 
```

---

## 4. âœ‹ Hands vs. Controllers
*   **DistanceGrabbable (Rays)**: Works perfectly with both.
    *   *Controller*: Point ray + Trigger.
    *   *Hands*: Point ray (from wrist/pinch) + Pinch.
*   **OneHandGrabbable (Direct)**: 
    *   *Controller*: Touch + Grip Button.
    *   *Hands*: Touch + **Make a Fist**. (Note: Browser detection of "Fist/Squeeze" can vary, making Rays safer for general use).

---

## 5. âš ï¸ Pitfalls (Lessons Learned)
*   **HMR & Ghost Hands**: If you attach an object to `gripSpaces`, HMR (Hot Module Replacement) might not remove it automatically when you save code. You must explicitly remove it in `import.meta.hot.dispose`.
    ```typescript
    import.meta.hot.dispose(() => {
        rightHand.remove(gunMesh); // <--- Vital!
    });
    ```
*   **Ray Blocking**: If your attached gun has a collider, it might block your own teleport/UI ray. Set `pointerEventsType = { deny: 'ray' }` or disable raycasting on the gun mesh.

---

## ðŸ“š Source Code References
For deeper debugging, refer to these SDK files:

*   **Input polling & Gamepad logic:**
    *   `node_modules/@iwsdk/core/dist/input/input-system.js`
    *   `node_modules/@iwsdk/core/dist/input/input-system.d.ts`
*   **Grabbing Logic (Direct vs Distance):**
    *   `node_modules/@iwsdk/core/dist/grab/grab-system.js`
    *   `node_modules/@iwsdk/core/dist/grab/handles.js`

*Generated by Antigravity Agent - 2025*
