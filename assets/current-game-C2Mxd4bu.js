import{D as j,B as H,M as A,a as B,P as F,b as S,c as N,d as K,I as U,O as q,e as J,f as Q,T as $,G as z,V as ee}from"./index-DnL1nmyS.js";const f=window.__IWSDK_WORLD__,b=[],T=[],Z=new WeakMap,x={A:"a-button",B:"b-button"},O=new j(16777215,1);O.position.set(1,3,1);f.scene.add(O);b.push(O);const V=.5,ne=new H(20,V,20),te=new A({transparent:!0,opacity:0}),I=new B(ne,te);I.position.set(0,-V/2,0);f.scene.add(I);const R=f.createTransformEntity(I);R.addComponent(F,{state:S.Static});R.addComponent(N,{shape:K.Auto,restitution:.8,friction:.5});T.push(R);b.push(I);function u(o,e={}){const n=f.createTransformEntity(o);let a=S.Dynamic;return e.dynamic===!1&&(a=S.Static),e.kinematic&&(a=S.Kinematic),n.addComponent(F,{state:a,linearDamping:e.damping??0,angularDamping:e.angularDamping??0,gravityFactor:e.noGravity?0:1}),n.addComponent(N,{shape:K.Auto,restitution:e.restitution??(e.bouncy?.9:.5),density:e.density??(e.heavy?3:1),friction:e.friction??(e.slippery?.1:.5)}),e.grabbable!==!1&&e.dynamic!==!1&&(n.addComponent(U),e.directGrab?n.addComponent(q):n.addComponent(J,{movementMode:Q.MoveFromTarget}),e.scalable&&n.addComponent($)),T.push(n),Z.set(o,n),n}function E(o,e,n=.2){const[a,i,D]=Array.isArray(n)?n:[n,n,n],_=new H(a,i,D),h=new A({color:e,roughness:.4,metalness:.2}),p=new B(_,h);return p.position.set(...o),f.scene.add(p),b.push(p),p}function oe(o="right"){return f.input.gamepads[o]}function ae(o){return Z.get(o)||null}function P(o){o.parent&&o.parent.remove(o);const e=b.indexOf(o);if(e!==-1){b.splice(e,1);const n=T[e];if(n){try{n.destroy()}catch{}T.splice(e,1)}}}console.log("ðŸŽ® 3D Tetris!");const t=.15,G=6,M=6,X=10,se=2.2,c=.05,r=0,l=-1.5,ce=[16711680,65280,255,16776960,16711935,65535,16746496],L=[[[0,0,0],[1,0,0],[2,0,0],[3,0,0]],[[0,0,0],[1,0,0],[0,0,1],[1,0,1]],[[0,0,0],[1,0,0],[2,0,0],[1,0,1]],[[0,0,0],[0,0,1],[0,0,2],[1,0,2]],[[1,0,0],[1,0,1],[1,0,2],[0,0,2]],[[0,0,0],[1,0,0],[1,0,1],[2,0,1]],[[1,0,0],[2,0,0],[0,0,1],[1,0,1]]];let s=null,W=null,y=[],m=0,g=!1;const ie=E([r,c,l],3355494,[G*t,.02,M*t]);u(ie,{dynamic:!1,grabbable:!1});const v=4474026,d=.02,w=X*t,re=E([r,c+w/2,l-M*t/2-d],v,[G*t,w,d]);u(re,{dynamic:!1,grabbable:!1});const le=E([r-G*t/2-d,c+w/2,l],v,[d,w,M*t]);u(le,{dynamic:!1,grabbable:!1});const de=E([r+G*t/2+d,c+w/2,l],v,[d,w,M*t]);u(de,{dynamic:!1,grabbable:!1});const fe=E([r,c+.05,l+M*t/2+d],v,[G*t,.1,d]);u(fe,{dynamic:!1,grabbable:!1});function C(){if(g)return;const o=Math.floor(Math.random()*L.length),e=L[o],n=ce[o],a=new z;a.position.set(r,se,l),e.forEach(([i,D,_])=>{const h=new H(t*.95,t*.95,t*.95),p=new A({color:n,metalness:.3,roughness:.4,emissive:n,emissiveIntensity:.2}),k=new B(h,p);k.position.set((i-1.5)*t,D*t,(_-1)*t),a.add(k)}),f.scene.add(a),s=a,W=u(a,{grabbable:!0,dynamic:!0,damping:.5}),b.push(a)}function ue(){if(!s)return;s.position.clone();const o=[...s.children];P(s),o.forEach(e=>{const n=new ee;e.getWorldPosition(n);const a=Math.round((n.x-r)/t)*t+r,i=Math.max(c+t/2,Math.round((n.y-c)/t)*t+c),D=Math.round((n.z-l)/t)*t+l,_=e.material,h=E([a,i,D],_.color.getHex(),t*.95);u(h,{dynamic:!1,grabbable:!1}),y.push(h),i>c+X*t&&(g=!0,console.log("ðŸ’€ Game Over! Score: "+m))}),m+=10,console.log("ðŸ“¦ Piece placed! Score: "+m),s=null,W=null,he(),g||setTimeout(()=>C(),500)}function he(){const o={};y.forEach(n=>{const a=Math.round((n.position.y-c)/t);o[a]||(o[a]=[]),o[a].push(n)});const e=[];Object.keys(o).forEach(n=>{const a=parseInt(n);o[a].length>=G*M*.7&&e.push(a)}),e.length>0&&(e.forEach(n=>{o[n].forEach(a=>{P(a),y=y.filter(i=>i!==a)})}),m+=e.length*100,console.log("ðŸŽ‰ Cleared "+e.length+" layer(s)! Score: "+m))}C();const Y=o=>{if(g)return;s&&W&&(ae(s)?.isGrabbed?.()||s.position.y<c+t*2&&ue());const e=oe("right");e?.getButtonDown(x.A)&&!s&&!g&&C(),e?.getButtonDown(x.B)&&(y.forEach(n=>P(n)),y=[],s&&(P(s),s=null),m=0,g=!1,console.log("ðŸ”„ Game Reset!"),C())};window.__GAME_UPDATE__=typeof Y<"u"?Y:()=>{};
